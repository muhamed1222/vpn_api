# API –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å–æ–≤ –∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã

## –°–æ–∑–¥–∞–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### 1. –ö–æ–Ω–∫—É—Ä—Å—ã

#### `GET /v1/contest/active`
–ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∫–æ–Ω–∫—É—Ä—Å.

**–û—Ç–≤–µ—Ç:**
```json
{
  "contest": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "title": "üéâ –†–æ–∑—ã–≥—Ä—ã—à Outlivion ‚Äî 10 –ø—Ä–∏–∑–æ–≤!",
    "starts_at": "2025-01-01T00:00:00.000Z",
    "ends_at": "2025-02-05T23:59:59.000Z",
    "attribution_window_days": 7,
    "rules_version": "1.0",
    "is_active": true
  }
}
```

### 2. –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞

#### `GET /v1/referral/summary?contest_id={id}`
–ü–æ–ª—É—á–∏—Ç—å —Å–≤–æ–¥–∫—É –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `contest_id` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - ID –∫–æ–Ω–∫—É—Ä—Å–∞

**–û—Ç–≤–µ—Ç:**
```json
{
  "summary": {
    "contest": { ... },
    "ref_link": "https://t.me/outlivion_bot?start=REF12345678",
    "tickets_total": 12,
    "invited_total": 5,
    "qualified_total": 3,
    "pending_total": 2
  }
}
```

#### `GET /v1/referral/friends?contest_id={id}&limit={limit}`
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö –¥—Ä—É–∑–µ–π.

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `contest_id` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - ID –∫–æ–Ω–∫—É—Ä—Å–∞
- `limit` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π

**–û—Ç–≤–µ—Ç:**
```json
{
  "friends": [
    {
      "id": "1",
      "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
      "tg_username": "ivan_ivanov",
      "status": "qualified",
      "status_reason": null,
      "tickets_from_friend_total": 6,
      "bound_at": "2025-01-15T10:30:00.000Z"
    }
  ]
}
```

#### `GET /v1/referral/tickets?contest_id={id}&limit={limit}`
–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –±–∏–ª–µ—Ç–æ–≤.

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `contest_id` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - ID –∫–æ–Ω–∫—É—Ä—Å–∞
- `limit` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π

**–û—Ç–≤–µ—Ç:**
```json
{
  "tickets": [
    {
      "id": "order-123",
      "created_at": "2025-01-15T10:30:00.000Z",
      "delta": 6,
      "label": "–û–ø–ª–∞—Ç–∞ 6 –º–µ—Å—è—Ü–µ–≤ –æ—Ç –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
      "invitee_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤"
    }
  ]
}
```

## –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω–∫—É—Ä—Å–∞

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:

```bash
cd vpn_bot
npx ts-node scripts/create_contest.ts
```

–ò–ª–∏ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:

```bash
npx ts-node scripts/create_contest.ts \
  --id "contest-2025-01" \
  --title "üéâ –†–æ–∑—ã–≥—Ä—ã—à Outlivion ‚Äî 10 –ø—Ä–∏–∑–æ–≤!" \
  --start "2025-01-01T00:00:00Z" \
  --end "2025-02-05T23:59:59Z" \
  --window 7 \
  --version "1.0" \
  --active
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–¢–∞–±–ª–∏—Ü–∞ `contests` —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞:

```sql
CREATE TABLE IF NOT EXISTS contests (
  id TEXT PRIMARY KEY,
  title TEXT NOT NULL,
  starts_at TEXT NOT NULL,
  ends_at TEXT NOT NULL,
  attribution_window_days INTEGER DEFAULT 7,
  rules_version TEXT DEFAULT '1.0',
  is_active INTEGER DEFAULT 0
);
```

## –ü–æ–¥—Å—á–µ—Ç –±–∏–ª–µ—Ç–æ–≤

–ë–∏–ª–µ—Ç—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ `plan_id`:
- `plan_30` = 1 –±–∏–ª–µ—Ç (1 –º–µ—Å—è—Ü)
- `plan_90` = 3 –±–∏–ª–µ—Ç–∞ (3 –º–µ—Å—è—Ü–∞)
- `plan_180` = 6 –±–∏–ª–µ—Ç–æ–≤ (6 –º–µ—Å—è—Ü–µ–≤)
- `plan_365` = 12 –±–∏–ª–µ—Ç–æ–≤ (12 –º–µ—Å—è—Ü–µ–≤)

## –°—Ç–∞—Ç—É—Å—ã –¥—Ä—É–∑–µ–π

- `bound` - –¥—Ä—É–≥ –ø–µ—Ä–µ—à–µ–ª –ø–æ —Å—Å—ã–ª–∫–µ, –Ω–æ –µ—â–µ –Ω–µ –æ–ø–ª–∞—Ç–∏–ª
- `qualified` - –¥—Ä—É–≥ –æ–ø–ª–∞—Ç–∏–ª –ø–æ–¥–ø–∏—Å–∫—É
- `not_qualified` - –¥—Ä—É–≥ –Ω–µ –ø—Ä–æ—à–µ–ª –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—é
- `blocked` - –¥—Ä—É–≥ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (–Ω–∞–∫—Ä—É—Ç–∫–∞ –∏ —Ç.–¥.)
