# Бизнес-логика проекта

## Общая концепция продукта

Outlivion - это VPN-сервис, предоставляющий пользователям защищенное интернет-соединение через протокол VLESS с Reality. Сервис ориентирован на русскоязычную аудиторию и интегрирован с экосистемой Telegram для удобной авторизации и управления подписками.

## Целевая аудитория

Продукт предназначен для пользователей, которым необходимо:
- Обойти географические ограничения и блокировки контента
- Обеспечить приватность и безопасность интернет-соединения
- Получить доступ к заблокированным ресурсам
- Защитить данные при использовании публичных Wi-Fi сетей

Основной канал привлечения - Telegram, что делает сервис доступным для широкой аудитории без необходимости регистрации на отдельном сайте.

## Решаемые проблемы

### Проблема доступности
Сервис решает проблему ограниченного доступа к интернет-ресурсам, предоставляя стабильное VPN-соединение с серверами в Нидерландах.

### Проблема сложности настройки
Интеграция с Telegram упрощает процесс авторизации и управления подпиской. Пользователь получает готовый конфигурационный файл, который можно использовать в VPN-клиентах без сложных настроек.

### Проблема прозрачности
Пользователи получают полную информацию о статусе подписки, использованном трафике и сроке действия через API, что обеспечивает прозрачность использования сервиса.

## Тарифная модель

### Пробный период
Предоставляется тариф на 7 дней стоимостью 10 рублей. Доступен только один раз для каждого пользователя. Система проверяет историю заказов как в API, так и в базе данных бота, чтобы предотвратить повторное использование пробного периода.

### Основные тарифы
- **30 дней** - 99 рублей (базовый тариф)
- **90 дней** - 260 рублей (скидка ~12%)
- **180 дней** - 499 рублей (скидка ~16%)
- **365 дней** - 899 рублей (скидка ~24%)

Длительные тарифы предоставляют экономию по сравнению с помесячной оплатой, мотивируя пользователей к долгосрочным подпискам.

### Альтернативная валюта
Тарифы также доступны для оплаты через Telegram Stars, что расширяет возможности оплаты для пользователей Telegram.

## Бизнес-процессы

### Процесс покупки подписки

1. **Выбор тарифа** - пользователь просматривает доступные тарифы через API. Для авторизованных пользователей пробный тариф скрывается, если у них уже были оплаченные заказы.

2. **Создание заказа** - при выборе тарифа создается заказ со статусом `pending`. Заказ привязывается к Telegram ID пользователя.

3. **Оплата** - система создает платеж в YooKassa и возвращает пользователю ссылку для оплаты. Платеж включает чек для налоговой отчетности (требование для РФ).

4. **Активация подписки** - после успешной оплаты YooKassa отправляет webhook. Система автоматически:
   - Определяет количество дней подписки по выбранному тарифу
   - Создает или продлевает VPN-пользователя в Marzban
   - Генерирует конфигурационный ключ
   - Сохраняет ключ в базе данных
   - Отправляет уведомление пользователю в Telegram

5. **Получение ключа** - пользователь может получить свой VPN-ключ через API или через Telegram-бота.

### Процесс управления подпиской

**Проверка статуса** - пользователь может проверить:
- Активность подписки
- Дату окончания действия
- Использованный трафик
- Лимит трафика (если установлен)

**Регенерация ключа** - пользователь может сгенерировать новый VPN-ключ, если текущий был скомпрометирован или утерян. Старый ключ автоматически деактивируется.

**Продление подписки** - при покупке нового тарифа система автоматически продлевает существующую подписку, добавляя дни к текущей дате окончания, если подписка еще активна.

### Процесс реферальной программы

Система отслеживает рефералов пользователя и предоставляет статистику:
- Общее количество приглашенных пользователей
- Количество пользователей, активировавших пробный период
- Количество пользователей, купивших платные тарифы

Реферальная программа мотивирует пользователей приглашать новых клиентов, способствуя органическому росту сервиса.

## Бизнес-правила

### Ограничение пробного периода
Пробный тариф доступен только один раз на пользователя. Система проверяет наличие оплаченных заказов в двух источниках:
- База данных API (таблица `orders`)
- База данных Telegram-бота (если доступна)

Это предотвращает злоупотребление пробным периодом через создание новых аккаунтов.

### Идемпотентность операций
Все критические операции (активация подписки, обработка платежей) являются идемпотентными. Повторная обработка одного и того же события не приводит к дублированию действий или изменению состояния.

### Кэширование ключей
VPN-ключи кэшируются в локальной базе данных для быстрого доступа. При первом запросе ключ получается из Marzban и сохраняется в кэш, последующие запросы используют кэшированное значение.

### Автоматическое продление
При покупке нового тарифа, если текущая подписка активна, дни добавляются к существующей дате окончания, а не устанавливается новая дата с момента покупки. Это обеспечивает справедливое начисление времени подписки.

## Интеграции

### Telegram
Используется для:
- Авторизации пользователей через Telegram Mini App
- Отправки уведомлений об активации подписки
- Управления подписками через бота

### YooKassa
Обрабатывает платежи с поддержкой:
- Банковских карт
- Электронных кошельков
- Telegram Stars (через отдельную интеграцию)

### Marzban
Управляет VPN-инфраструктурой:
- Создание и управление пользователями
- Генерация конфигурационных файлов
- Мониторинг использования трафика
- Управление серверами

## Монетизация

Основной источник дохода - продажа подписок на VPN-сервис. Модель ценообразования:
- Низкий порог входа (пробный период за 10 рублей)
- Градация тарифов с выгодой при долгосрочной подписке
- Альтернативные способы оплаты (Telegram Stars)

Реферальная программа способствует привлечению новых пользователей без прямых затрат на рекламу.

## Конкурентные преимущества

1. **Простота использования** - интеграция с Telegram, автоматическая активация после оплаты
2. **Прозрачность** - полная информация о статусе подписки и использовании трафика
3. **Гибкость** - возможность регенерации ключей, продление подписки
4. **Доступность** - низкая стоимость пробного периода, различные способы оплаты
5. **Надежность** - автоматическая обработка платежей, идемпотентные операции

## Масштабирование

Система спроектирована для обработки:
- Средний объем заказов: 10-50 в день
- Высокая конверсия: ~85%
- Быстрая активация подписок после оплаты
- Стабильная работа при росте нагрузки

Архитектура позволяет легко добавлять новые тарифы, интегрировать дополнительные платежные системы и расширять функциональность без изменения базовой логики.
