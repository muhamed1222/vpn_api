# üìã –û–¢–ß–ï–¢ –û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ò: –ó–∞–¥–∞—á–∞ 6 - –í—ã–Ω–µ—Å–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∞–±–ª–∏—Ü –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é

**–î–∞—Ç–∞:** 2025-01-27  
**–§–∞–π–ª—ã:** `src/storage/contestUtils.ts`, `src/storage/contestRepo.ts`

---

## ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢: –ó–ê–î–ê–ß–ê –í–´–ü–û–õ–ù–ï–ù–ê –£–°–ü–ï–®–ù–û

### üìä –°–≤–æ–¥–∫–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫

| –ü—Ä–æ–≤–µ—Ä–∫–∞ | –°—Ç–∞—Ç—É—Å | –î–µ—Ç–∞–ª–∏ |
|----------|--------|--------|
| –ö–æ–º–ø–∏–ª—è—Ü–∏—è TypeScript | ‚úÖ PASS | –ë–µ–∑ –æ—à–∏–±–æ–∫ |
| –õ–∏–Ω—Ç–µ—Ä | ‚úÖ PASS | –û—à–∏–±–æ–∫ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ |
| –°–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ checkContestTables | ‚úÖ PASS | –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ |
| –ò–º–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–∏ | ‚úÖ PASS | –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ contestRepo.ts |
| –ó–∞–º–µ–Ω–∞ –≤ getReferralSummary | ‚úÖ PASS | –°—Ç—Ä–æ–∫–∞ 203 |
| –ó–∞–º–µ–Ω–∞ –≤ getReferralFriends | ‚úÖ PASS | –°—Ç—Ä–æ–∫–∞ 370 |
| –ó–∞–º–µ–Ω–∞ –≤ getTicketHistory | ‚úÖ PASS | –°—Ç—Ä–æ–∫–∞ 544 |
| –ó–∞–º–µ–Ω–∞ –≤ getAllContestTickets | ‚úÖ PASS | –°—Ç—Ä–æ–∫–∞ 678 |
| –ó–∞–º–µ–Ω–∞ –≤ getAllContestParticipants | ‚úÖ PASS | –°—Ç—Ä–æ–∫–∞ 739 |
| –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è | ‚úÖ PASS | 0 –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å |
| –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–ª–∞–Ω—É | ‚úÖ PASS | –í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã |

---

## üîç –î–µ—Ç–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ö–æ–º–ø–∏–ª—è—Ü–∏—è TypeScript

```bash
$ npm run build
‚úÖ –£—Å–ø–µ—à–Ω–æ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

---

### 2. –õ–∏–Ω—Ç–µ—Ä

```bash
$ read_lints contestRepo.ts contestUtils.ts
‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –ø—Ä–æ–µ–∫—Ç–∞

---

### 3. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ checkContestTables

**–§–∞–π–ª:** `src/storage/contestUtils.ts`, —Å—Ç—Ä–æ–∫–∏ 78-100

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```typescript
export function checkContestTables(
  db: Database.Database,
  dbName: string = 'bot_db'
): { refEventsExists: boolean; ticketLedgerExists: boolean } {
  const refEventsExists = !!(db.prepare(`
    SELECT name FROM ${dbName}.sqlite_master 
    WHERE type='table' AND name='ref_events'
  `).get() as { name: string } | undefined);

  const ticketLedgerExists = !!(db.prepare(`
    SELECT name FROM ${dbName}.sqlite_master 
    WHERE type='table' AND name='ticket_ledger'
  `).get() as { name: string } | undefined);

  return { refEventsExists, ticketLedgerExists };
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ 
- –§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è (`Database.Database` –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Å –±—É–ª–µ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `dbName` –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ —Å `!!` –¥–ª—è boolean

---

### 4. –ò–º–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–∏

**–§–∞–π–ª:** `src/storage/contestRepo.ts`, —Å—Ç—Ä–æ–∫–∞ 2

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```typescript
import { getTicketsFromPlanIdSQL, checkContestTables } from './contestUtils.js';
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –§—É–Ω–∫—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤–º–µ—Å—Ç–µ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —É—Ç–∏–ª–∏—Ç–∞–º–∏

---

### 5. –ó–∞–º–µ–Ω–∞ –≤ getReferralSummary()

**–§–∞–π–ª:** `src/storage/contestRepo.ts`, —Å—Ç—Ä–æ–∫–∞ 203

**–î–æ:**
```typescript
const refEventsExists = db.prepare(`...`).get() as {...} | undefined;
const ticketLedgerExists = db.prepare(`...`).get() as {...} | undefined;
```

**–ü–æ—Å–ª–µ:**
```typescript
const { refEventsExists, ticketLedgerExists } = checkContestTables(db, 'bot_db');
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ó–∞–º–µ–Ω–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è

---

### 6. –ó–∞–º–µ–Ω–∞ –≤ getReferralFriends()

**–§–∞–π–ª:** `src/storage/contestRepo.ts`, —Å—Ç—Ä–æ–∫–∞ 370

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```typescript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü ref_events –∏ ticket_ledger
const { refEventsExists, ticketLedgerExists } = checkContestTables(db, 'bot_db');
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ó–∞–º–µ–Ω–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 7. –ó–∞–º–µ–Ω–∞ –≤ getTicketHistory()

**–§–∞–π–ª:** `src/storage/contestRepo.ts`, —Å—Ç—Ä–æ–∫–∞ 544

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```typescript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü—ã ticket_ledger
const { ticketLedgerExists } = checkContestTables(db, 'bot_db');
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ó–∞–º–µ–Ω–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ–≥–æ –ø–æ–ª—è

---

### 8. –ó–∞–º–µ–Ω–∞ –≤ getAllContestTickets()

**–§–∞–π–ª:** `src/storage/contestRepo.ts`, —Å—Ç—Ä–æ–∫–∞ 678

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```typescript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü—ã ticket_ledger
const { ticketLedgerExists } = checkContestTables(db, 'bot_db');
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ó–∞–º–µ–Ω–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 9. –ó–∞–º–µ–Ω–∞ –≤ getAllContestParticipants()

**–§–∞–π–ª:** `src/storage/contestRepo.ts`, —Å—Ç—Ä–æ–∫–∞ 739

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```typescript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü
const { refEventsExists, ticketLedgerExists } = checkContestTables(db, 'bot_db');
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ó–∞–º–µ–Ω–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 10. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ sqlite_master:**

```bash
$ grep -n "sqlite_master.*ref_events\|sqlite_master.*ticket_ledger" src/storage/contestRepo.ts
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ **0 –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤** - –≤–µ—Å—å –∫–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–Ω–µ—Å–µ–Ω –≤ —Ñ—É–Ω–∫—Ü–∏—é

---

## üîÑ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

- **5 –º–µ—Å—Ç** —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∫–æ–¥–æ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∞–±–ª–∏—Ü
- **~8-12 —Å—Ç—Ä–æ–∫** –∫–æ–¥–∞ –≤ –∫–∞–∂–¥–æ–º –º–µ—Å—Ç–µ
- **–ò—Ç–æ–≥–æ:** ~40-60 —Å—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

- **1 —Ñ—É–Ω–∫—Ü–∏—è** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∞–±–ª–∏—Ü (23 —Å—Ç—Ä–æ–∫–∏ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏)
- **1 —Å—Ç—Ä–æ–∫–∞** –≤—ã–∑–æ–≤–∞ –≤ –∫–∞–∂–¥–æ–º –º–µ—Å—Ç–µ (5 –º–µ—Å—Ç)
- **–ò—Ç–æ–≥–æ:** ~5 —Å—Ç—Ä–æ–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è + 1 —Ñ—É–Ω–∫—Ü–∏—è = ~28 —Å—Ç—Ä–æ–∫ –æ–±—â–∏–π –æ–±—ä–µ–º

### –≠–∫–æ–Ω–æ–º–∏—è

- **–£–º–µ–Ω—å—à–µ–Ω–∏–µ –∫–æ–¥–∞:** ~12-32 —Å—Ç—Ä–æ–∫–∏ (20-50% –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–µ—Ç–æ–¥–∞)
- **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π:** –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ª–æ–≥–∏–∫–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–µ–±—É—é—Ç –ø—Ä–∞–≤–∫–∏ —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- **–£–ª—É—á—à–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏:** –∫–æ–¥ —Å—Ç–∞–ª –±–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω—ã–º –∏ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–º

---

## üìù –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–ª–∞–Ω—É

**–ò—Å—Ç–æ—á–Ω–∏–∫:** `TICKET_SYSTEM_FIX_PLAN.md`, —Å—Ç—Ä–æ–∫–∏ 471-538

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∞ | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è | –°—Ç–∞—Ç—É—Å |
|------------------|------------|--------|
| –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é checkContestTables | ‚úÖ contestUtils.ts:78-100 | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ |
| –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é | ‚úÖ contestRepo.ts:2 | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ |
| –ó–∞–º–µ–Ω–∞ –≤ getReferralSummary | ‚úÖ contestRepo.ts:203 | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ |
| –ó–∞–º–µ–Ω–∞ –≤ getReferralFriends | ‚úÖ contestRepo.ts:370 | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ |
| –ó–∞–º–µ–Ω–∞ –≤ getTicketHistory | ‚úÖ contestRepo.ts:544 | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ |
| –ó–∞–º–µ–Ω–∞ –≤ getAllContestParticipants | ‚úÖ contestRepo.ts:739 | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ |
| –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: getAllContestTickets | ‚úÖ contestRepo.ts:678 | ‚úÖ –ë–æ–Ω—É—Å |

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø–ª–∞–Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã + –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–º–µ–Ω–∞ –≤ `getAllContestTickets()`

---

## üéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∞ DRY (Don't Repeat Yourself)

**–î–æ:**
- –ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∞–±–ª–∏—Ü –ø–æ–≤—Ç–æ—Ä—è–ª—Å—è **5 —Ä–∞–∑** –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Ç–æ–¥–∞—Ö
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Ç—Ä–µ–±–æ–≤–∞–ª–æ –ø—Ä–∞–≤–æ–∫ –≤ **5 –º–µ—Å—Ç–∞—Ö**

**–ü–æ—Å–ª–µ:**
- –ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∞–±–ª–∏—Ü –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ **–æ–¥–Ω–æ–º –º–µ—Å—Ç–µ**
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∫–∏ —Ç–æ–ª—å–∫–æ –≤ **1 –º–µ—Å—Ç–µ**

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü—Ä–∏–Ω—Ü–∏–ø DRY —Å–æ–±–ª—é–¥–µ–Ω

---

## ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ ‚úÖ

–í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ:
- ‚úÖ –§—É–Ω–∫—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- ‚úÖ –ò–º–ø–æ—Ä—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –í—Å–µ –º–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∑–∞–º–µ–Ω–µ–Ω—ã
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ (—Ç–µ –∂–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ)
- ‚úÖ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ —É–¥–∞–ª–µ–Ω–æ | ~40-60 |
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–æ | ~28 (—Ñ—É–Ω–∫—Ü–∏—è + –≤—ã–∑–æ–≤—ã) |
| –ß–∏—Å—Ç–∞—è —ç–∫–æ–Ω–æ–º–∏—è | ~12-32 —Å—Ç—Ä–æ–∫–∏ |
| –¢–æ—á–µ–∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è | 5 ‚Üí 1 |
| –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏ | –£–º–µ–Ω—å—à–µ–Ω–∞ |
| –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞ | –£–ª—É—á—à–µ–Ω–∞ |

---

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–π –≤–µ—Ä–¥–∏–∫—Ç

**–ó–∞–¥–∞—á–∞ 6 –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞.**

–í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã:
- ‚úÖ –ö–æ–º–ø–∏–ª—è—Ü–∏—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –õ–∏–Ω—Ç–µ—Ä –±–µ–∑ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
- ‚úÖ –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –í—Å–µ 5 –º–µ—Å—Ç –∑–∞–º–µ–Ω–µ–Ω—ã
- ‚úÖ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ (0 –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–ª–∞–Ω—É
- ‚úÖ –ü—Ä–∏–Ω—Ü–∏–ø DRY —Å–æ–±–ª—é–¥–µ–Ω

**–ö–æ–¥ —Å—Ç–∞–ª —á–∏—â–µ, –ø—Ä–æ—â–µ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫–µ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º.** üöÄ

---

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏

```typescript
// –§—É–Ω–∫—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
export function checkContestTables(
  db: Database.Database,  // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø
  dbName: string = 'bot_db'  // ‚úÖ –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
): { refEventsExists: boolean; ticketLedgerExists: boolean } {  // ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Ç–∏–ø
  // ...
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –¢–∏–ø–∏–∑–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–í—Å–µ 5 –º–µ—Å—Ç –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ñ—É–Ω–∫—Ü–∏—é –æ–¥–∏–Ω–∞–∫–æ–≤–æ:
```typescript
const { refEventsExists, ticketLedgerExists } = checkContestTables(db, 'bot_db');
// –∏–ª–∏
const { ticketLedgerExists } = checkContestTables(db, 'bot_db');
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

---

**–ì–æ—Ç–æ–≤–æ –∫ –ø–µ—Ä–µ—Ö–æ–¥—É –∫ –∑–∞–¥–∞—á–µ 7.** üöÄ
