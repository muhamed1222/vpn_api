# –ò–∑–º–µ–Ω–µ–Ω–∏—è, –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–î–∞—Ç–∞:** 2025-01-18  
**–°—Ç–∞—Ç—É—Å:** –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

---

## üìã –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 1. ‚ùå –ù–û–í–´–ô –§–ê–ô–õ: `src/services/awardRetryScheduler.ts`

**–°—Ç–∞—Ç—É—Å:** –§–∞–π–ª —Å–æ–∑–¥–∞–Ω –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–æ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- –ö–ª–∞—Å—Å `AwardRetryScheduler` - –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∏–ª–µ—Ç–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç (—á–µ—Ä–µ–∑ `node-cron`)
- –û—á–µ—Ä–µ–¥—å –Ω–µ—É–¥–∞—á–Ω—ã—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π (`Map<string, FailedAward>`)
- –ú–µ—Ç–æ–¥—ã: `addToRetryQueue()`, `getStats()`, `stop()`

**–†–∞–∑–º–µ—Ä:** 6.3 KB

**–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:**
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤ –ø—Ä–∏ —Å–±–æ—è—Ö
- –£–ª—É—á—à–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã

---

### 2. ‚ùå –û–ë–ù–û–í–õ–ï–ù: `package.json`

**–°—Ç–∞—Ç—É—Å:** –ò–∑–º–µ–Ω–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
```diff
  "dependencies": {
+   "@types/node-cron": "^3.0.11",
+   "node-cron": "^4.2.1",  // ‚Üê –ù–û–í–ê–Ø –ó–ê–í–ò–°–ò–ú–û–°–¢–¨
    ...
  }
```

**–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:**
- –ë–µ–∑ `node-cron` –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- –¢–∏–ø—ã TypeScript (`@types/node-cron`) –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

---

### 3. ‚ùå –û–ë–ù–û–í–õ–ï–ù: `src/routes/v1/payments.ts`

**–°—Ç–∞—Ç—É—Å:** –ò–∑–º–µ–Ω–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**

**a) –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞:**
```typescript
import { awardRetryScheduler } from '../../services/awardRetryScheduler.js';
```

**b) –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∏–ª–µ—Ç–æ–≤:**
```typescript
// –°–¢–ê–†–ê–Ø –í–ï–†–°–ò–Ø:
catch (ticketError: any) {
  fastify.log.error({ err: ticketError?.message, tgId, orderId }, '[Webhook] Failed to award tickets');
  // –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å - –æ–ø–ª–∞—Ç–∞ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞
}

// –ù–û–í–ê–Ø –í–ï–†–°–ò–Ø:
catch (ticketError: any) {
  fastify.log.error({ 
    err: ticketError?.message,
    stack: ticketError?.stack,  // ‚Üê –î–û–ë–ê–í–õ–ï–ù STACK
    tgId, 
    orderId 
  }, '[Webhook] ‚ùå Failed to award tickets (non-critical)');
  
  // –î–û–ë–ê–í–õ–ï–ù–û: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å –ø–æ–≤—Ç–æ—Ä–æ–≤
  awardRetryScheduler.addToRetryQueue(
    tgId,
    orderId,
    planId,
    orderCreatedAt,
    ticketError?.message
  );
}
```

**–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –≤ –æ—á–µ—Ä–µ–¥—å –ø–æ–≤—Ç–æ—Ä–æ–≤
- –ë–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (stack trace)

---

### 4. ‚ùå –û–ë–ù–û–í–õ–ï–ù: `src/storage/contestUtils.ts`

**–°—Ç–∞—Ç—É—Å:** –ò–∑–º–µ–Ω–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**

**–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï:** –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∏–ª–µ—Ç–æ–≤ –æ–±–µ—Ä–Ω—É—Ç—ã –≤ **—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**

**–°–¢–ê–†–ê–Ø –í–ï–†–°–ò–Ø (–±–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π):**
```typescript
// 1. –í–°–ï–ì–î–ê –Ω–∞—á–∏—Å–ª—è–µ–º –±–∏–ª–µ—Ç—ã —Å–∞–º–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
db.prepare(`INSERT INTO bot_db.ticket_ledger ...`).run(...);

// 2. –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–µ—Ñ–µ—Ä–µ—Ä - –Ω–∞—á–∏—Å–ª—è–µ–º –±–∏–ª–µ—Ç—ã –µ–º—É
if (referrerId !== null) {
  db.prepare(`INSERT INTO bot_db.ticket_ledger ...`).run(...);
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ref_events...
}

// –ü–†–û–ë–õ–ï–ú–ê: –ï—Å–ª–∏ –≤—Ç–æ—Ä–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è —É–ø–∞–¥–µ—Ç, –ø–µ—Ä–≤–∞—è —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞!
// –ë–∞–∑–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
```

**–ù–û–í–ê–Ø –í–ï–†–°–ò–Ø (—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏):**
```typescript
// –û–ë–û–†–ê–ß–ò–í–ê–ï–ú –í–°–ï –û–ü–ï–†–ê–¶–ò–ò –í –¢–†–ê–ù–ó–ê–ö–¶–ò–Æ
const awardTicketsTransaction = db.transaction((
  contestId, referredId, referrerId, orderId, ticketsDelta, ...
) => {
  // 1. –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª—é
  db.prepare(`INSERT INTO bot_db.ticket_ledger ...`).run(...);
  
  // 2. –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–µ—Ä—É (–µ—Å–ª–∏ –µ—Å—Ç—å)
  if (referrerId !== null) {
    db.prepare(`INSERT INTO bot_db.ticket_ledger ...`).run(...);
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ref_events...
  }
});

// –í–´–ü–û–õ–ù–ï–ù–ò–ï –¢–†–ê–ù–ó–ê–ö–¶–ò–ò (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π COMMIT –∏–ª–∏ ROLLBACK)
try {
  awardTicketsTransaction(...);
} catch (transactionError) {
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
}
```

**–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:**
- **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å:** –õ–∏–±–æ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è, –ª–∏–±–æ –Ω–∏ –æ–¥–Ω–∞
- **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:** –ë–∞–∑–∞ –≤—Å–µ–≥–¥–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –≤ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥–µ—Ç –Ω–µ —Ç–∞–∫, –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–∫–∞—Ç—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

### 5. ‚ùå –û–ë–ù–û–í–õ–ï–ù: `src/routes/v1/admin.ts`

**–°—Ç–∞—Ç—É—Å:** –ò–∑–º–µ–Ω–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**

**a) –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç:**
```typescript
import { awardRetryScheduler } from '../../services/awardRetryScheduler.js';
```

**b) –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π endpoint –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**
```typescript
/**
 * GET /v1/admin/award-retry-stats
 * –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ—á–µ—Ä–µ–¥–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∏–ª–µ—Ç–æ–≤
 */
fastify.get(
  '/award-retry-stats',
  {
    preHandler: [verifyAuth, verifyAdmin]
  },
  async (request, reply) => {
    const stats = awardRetryScheduler.getStats();
    return reply.send(stats);
  }
);
```

**–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:**
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—á–µ—Ä–µ–¥–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ —á–µ—Ä–µ–∑ API
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫, –ø–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏
- –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º

---

## üìä –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –§–∞–π–ª | –¢–∏–ø –∏–∑–º–µ–Ω–µ–Ω–∏—è | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –†–∞–∑–º–µ—Ä |
|------|---------------|-------------|--------|
| `src/services/awardRetryScheduler.ts` | üÜï –ù–æ–≤—ã–π —Ñ–∞–π–ª | ‚ö†Ô∏è –í—ã—Å–æ–∫–∞—è | 6.3 KB |
| `package.json` | ‚úèÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω | ‚ö†Ô∏è –í—ã—Å–æ–∫–∞—è | +2 —Å—Ç—Ä–æ–∫–∏ |
| `package-lock.json` | ‚úèÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω | ‚ö†Ô∏è –í—ã—Å–æ–∫–∞—è | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| `src/routes/v1/payments.ts` | ‚úèÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω | ‚ö†Ô∏è –í—ã—Å–æ–∫–∞—è | ~50 —Å—Ç—Ä–æ–∫ |
| `src/storage/contestUtils.ts` | ‚úèÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω | üî¥ **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø** | ~80 —Å—Ç—Ä–æ–∫ |
| `src/routes/v1/admin.ts` | ‚úèÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω | ‚ö†Ô∏è –°—Ä–µ–¥–Ω—è—è | ~20 —Å—Ç—Ä–æ–∫ |

---

## üîç –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–µ–π—á–∞—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–±–µ–∑ —ç—Ç–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π)

### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏:

1. **–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:**
   - –ï—Å–ª–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–µ—Ä—É —É–ø–∞–¥–µ—Ç –ø–æ—Å–ª–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –ø–æ–∫—É–ø–∞—Ç–µ–ª—é
   - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
   - –ü–æ–∫—É–ø–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª –±–∏–ª–µ—Ç—ã, –Ω–æ —Ä–µ—Ñ–µ—Ä–µ—Ä - –Ω–µ—Ç (—Ö–æ—Ç—è –¥–æ–ª–∂–µ–Ω –±—ã–ª)

2. **–ù–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫:**
   - –ï—Å–ª–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤ —É–ø–∞–¥–µ—Ç –∏–∑-–∑–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –æ—à–∏–±–∫–∏ (—Å–µ—Ç—å, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ë–î)
   - –ë–∏–ª–µ—Ç—ã **–Ω–µ –±—É–¥—É—Ç –Ω–∞—á–∏—Å–ª–µ–Ω—ã**, –¥–∞–∂–µ –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
   - –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ

3. **–ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**
   - –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–∫–æ–ª—å–∫–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π —É–ø–∞–ª–æ
   - –ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

---

## ‚úÖ –ß—Ç–æ –±—É–¥–µ—Ç –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏:

1. **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**
   - ‚úÖ –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞—Ç–æ–º–∞—Ä–Ω—ã
   - ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤—Å–µ–≥–¥–∞ –≤ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏:**
   - ‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—á–µ—Ä–µ–¥—å –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
   - ‚úÖ –î–æ 3 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ –∫–∞–∂–¥–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ
   - ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - ‚úÖ API endpoint `/v1/admin/award-retry-stats` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—á–µ—Ä–µ–¥–∏
   - ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏, –ø–æ–ø—ã—Ç–∫–∏, –æ—à–∏–±–∫–∏

4. **–£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - ‚úÖ Stack trace –≤ –æ—à–∏–±–∫–∞—Ö
   - ‚úÖ –ë–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

## üìù –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

```bash
# 1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
rsync -avz --exclude 'node_modules' --exclude '.git' \
  /Users/kelemetovmuhamed/Documents/Outlivion\ baza/vpn_api/ \
  root@72.56.93.135:/opt/outlivion-api/

# 2. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
ssh root@72.56.93.135 "cd /opt/outlivion-api && npm install"

# 3. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ - –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞
ssh root@72.56.93.135 "cd /opt/outlivion-api && npm run build"

# 4. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
ssh root@72.56.93.135 "systemctl restart outlivion-api"

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞
ssh root@72.56.93.135 "systemctl status outlivion-api"
ssh root@72.56.93.135 "journalctl -u outlivion-api -n 50 | grep -i scheduler"
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å

- **–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç:** –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- **–ù–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è - —É–ª—É—á—à–µ–Ω–∏—è:** –û–Ω–∏ –ø–æ–≤—ã—à–∞—é—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, –Ω–æ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Ä–∞–±–æ—Ç—ã
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –ù–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å–æ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–µ–π
- **–ú–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø–æ–∑–∂–µ:** –ú–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –≤ –ª—é–±–æ–µ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Ç–µ–∫—É—â—É—é —Ä–∞–±–æ—Ç—É

---

**–ò—Ç–æ–≥–æ:** 6 —Ñ–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ/—Å–æ–∑–¥–∞–Ω–æ, –≤—Å–µ —Å–≤—è–∑–∞–Ω—ã —Å —É–ª—É—á—à–µ–Ω–∏–µ–º –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∏–ª–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–æ–≤—Ç–æ—Ä–æ–≤ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥.
